{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'styles/catalogo.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static 'javascript/cart.js' %}" defer></script>
<script src="{% static 'javascript/catalogo.js' %}" defer></script>
<main>
    <section id="filterContainer" class="m-auto card p-4 col-md-6 col-lg-4 rounded-lg base my-5">
        <form action="" method="GET" class="text-center">
            <h2 class="text-primary font-weight-bold">Buscar productos</h2>
            <article class="input-group mb-3">
                <input type="text" name="find" id="find" placeholder="Nombre del producto" class="form-control">
                <article class="input-group-append">
                    <button type="submit" class="btn btn-primary">Buscar</button>
                </article>
            </article>
        </form>
        <form action="" method="GET" class="text-center mt-1">
            <h2 class="text-primary font-weight-bold">Filtrar productos</h2>
            <article class="my-2">
                <label for="availables" class="form-check-label"><span class="badge bg-success">Mostrar solo disponibles</span></label>
                <input type="checkbox" name="availables" id="availables" class="form-check-input">
            </article>
            <article class="input-group">
                <select name="ordenar" id="ordenar" class="form-select">
                    <option value="">Alfabeticamente (Ascendente)</option>
                    <option value="">Alfabeticamente (Descendente)</option>
                    <option value="">Precio/Unidad (Mayor a menor)</option>
                    <option value="">Precio/Unidad (Menor a mayor)</option>
                </select>
                <article class="input-group-append">
                    <button type="submit" class="btn btn-primary">Aplicar</button>
                </article>
            </article>

        </form>
    </section>
    <section class="bg-light bg-gradient">
        <section class="container">
            <section class="row">
                <h1 class="text-center text-primary">Productos</h1>
                {% if productos %}
                {% for p in productos %}
                <article class="col-md-4 producto">
                    <form action="" method="POST">
                        <article class="card my-2 box-shadow">
                            <article class="bg-dark p-1 text-center">
                                <h3 class="text-white center-block">{{p.descripcion}}</h3>
                            </article>
                            <article class="card-body bg-dark text-light">
                                <h3 class="text-bold">Referencia de fábrica:</h3>
                                <caption class="card-text">{{p.referencia_fabrica}}</caption>
                                <article class="d-flex justify-content-between align-items-start mt-2">
                                    <section class="">
                                        <form action="" class="product_inputs product-form">
                                            {% csrf_token %}
                                            <span class="badge mb-2 {% if p.id|stringformat:'s' in carrito %} btn-warning {% else %} btn-success {% endif %}">{% if p.id|stringformat:'s' in carrito %} Producto ya añadido {% else %} Cantidad {% endif %}</span>
                                            <input type="number" name="" id="" min="1" value="1" class="cantidad">
                                            <button class="btn {% if p.id|stringformat:'s' in carrito %} btn-warning {% else %} btn-success {% endif %} my-2 cart-handler" data-producto-id="{{ p.id }}" data-carthandler-url="{% url 'carthandler' %}" data-action="1">{% if p.id|stringformat:'s' in carrito %} Actualizar cantidad {% else %} Agregar al carrito {% endif %}</button>
                                            {% if p.id|stringformat:'s' in carrito %}
                                            <button type="button" class="btn btn-primary btn-sm me-1 mb-2 cart-handler" data-producto-id="{{p.id}}" data-carthandler-url="{% url 'carthandler' %}" data-action="2" title="Eliminar item">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                            {% endif %}
                                        </form>
                                    </section>
                                    <small>
                                        ${{p.precio}} <br>
                                        Cod. {{p.id}} <br>
                                        <span class="badge {% if p.cantidad == 0 %} bg-danger {% elif p.cantidad >= 1 and p.cantidad <= 10 %} bg-warning {% elif p.cantidad > 10 %} bg-success {% else %} bg-secondary {% endif %}">Cantidad disponible: {{p.cantidad}}</span>
                                    </small>
                                </article>
                            </article>
                        </article>
                    </form>
                </article>
                {% endfor %}
                {% else %}
                <p class="text-center fw-bold">No hay productos disponibles</p>
                {% endif %}
            </section>

            <!-- Paginacion -->
            <article class="pagination justify-content-center mt-4">
                <ul class="pagination">
                    {% if productos.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1" aria-label="First">
                                <span aria-hidden="true">&laquo;&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ productos.previous_page_number }}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                    {% endif %}
                    <li class="page-item disabled">
                        <span class="page-link">Página {{ productos.number }} de {{ productos.paginator.num_pages }}</span>
                    </li>

                    {% for i in productos.paginator.page_range %}
                        {% if i >= productos.number|add:"-3" and i <= productos.number|add:"3" %}
                            <li class="page-item {% if productos.number == i %}active{% endif %}">
                                <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if productos.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ productos.next_page_number }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ productos.paginator.num_pages }}" aria-label="Last">
                                <span aria-hidden="true">&raquo;&raquo;</span>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </article>


        </section>
    </section>
</main>

{% endblock %}